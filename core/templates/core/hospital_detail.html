{% extends 'core/base.html' %}
{% load static i18n %}
{% load custom_filters %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/hospital_detail.css' %}">
{% endblock %}
{% block content %}


<div class="detail-page">

  <!-- ── HERO ── -->
  <div class="dpage-hero">
    <div class="dpage-hero-inner">

      <a href="{% url 'all_hospitals' %}" class="dpage-back">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6" />
        </svg>
        {% trans "All Hospitals" %}
      </a>

      <div class="dpage-hero-row">
        <div style="flex:1;min-width:0;">
          <div class="dpage-badges">
            <span class="dpage-badge-type">{{ hospital_type_label }}</span>
            {% if hospital.rating %}
            <div class="dpage-badge-rating">
              <div class="stars">
                {% for i in rating_range %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <polygon
                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
                {% endfor %}
              </div>
              <span>{{ hospital.rating }}</span>
            </div>
            {% endif %}
          </div>
          <h1 class="dpage-name"><strong>{{ hospital.name }}</strong></h1>
          <p class="dpage-address">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            {{ hospital.address }}
          </p>
        </div>

        <div class="dpage-hero-actions">
          {% if map_url %}
          <a href="{{ map_url }}" target="_blank" class="dpage-btn-dir">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="3 11 22 2 13 21 11 13 3 11" />
            </svg>
            {% trans "Get Directions" %}
          </a>
          {% endif %}
          <button class="dpage-btn-share"
            onclick="navigator.share ? navigator.share({title:'{{ hospital.name }}', url: window.location.href}) : navigator.clipboard.writeText(window.location.href)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3" />
              <circle cx="6" cy="12" r="3" />
              <circle cx="18" cy="19" r="3" />
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
            </svg>
            {% trans "Share" %}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ── BODY ── -->
  <div class="dpage-body">
    <div class="dpage-grid">

      <!-- ── LEFT COLUMN ── -->
      <div>

        <!-- Specialities -->
        <div class="sec-card">
          <div class="sec-header">
            <div class="sec-icon sky">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                <path d="M9 12l2 2 4-4" />
              </svg>
            </div>
            <div>
              <h3 class="sec-title">{% trans "Medical Specialities" %}</h3>
              <p class="sec-sub">{% trans "Available departments and services" %}</p>
            </div>
          </div>

          {% if hospital.specialities %}
          <div class="spec-grid">
            {% for spec in hospital.specialities %}
            <div class="spec-item">
              <span class="spec-dot"></span>
              <span>{{ spec }}</span>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="8" x2="12" y2="12" />
              <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <p>{% trans "No specific specialities listed." %}</p>
          </div>
          {% endif %}
        </div>

        <!-- Facilities & Equipment -->
        <div class="sec-card">
          <div class="sec-header">
            <div class="sec-icon purple">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" />
                <path d="M3 9h18M9 21V9" />
              </svg>
            </div>
            <div>
              <h3 class="sec-title">{% trans "Facilities & Equipment" %}</h3>
              <p class="sec-sub">{% trans "Available infrastructure and services" %}</p>
            </div>
          </div>

          <span class="sec-label">{% trans "Bed Capacity" %}</span>
          <div class="bed-grid">
            <div class="bed-box blue">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 4v16M2 8h18a2 2 0 0 1 2 2v10M2 16h20M6 8v8" />
              </svg>
              <div class="bed-val">{{ hospital.total_beds }}</div>
              <div class="bed-lbl">{% trans "Total Beds" %}</div>
            </div>
            <div class="bed-box red">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
              </svg>
              <div class="bed-val">{{ hospital.icu_beds }}</div>
              <div class="bed-lbl">{% trans "ICU Beds" %}</div>
            </div>
            <div class="bed-box orange">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="1" y="3" width="15" height="13" rx="1" />
                <path d="M16 8h4l3 3v5h-7V8z" />
                <circle cx="5.5" cy="18.5" r="2.5" />
                <circle cx="18.5" cy="18.5" r="2.5" />
              </svg>
              <div class="bed-val">{{ hospital.emergency_beds }}</div>
              <div class="bed-lbl">{% trans "Emergency" %}</div>
            </div>
          </div>

          <span class="sec-label" style="margin-top:8px;">{% trans "Diagnostic Equipment" %}</span>
          <div class="facility-grid" style="margin-bottom:16px;">
            <div class="facility-item {% if facilities.xray %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.xray %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "X-Ray" %}
            </div>
            <div class="facility-item {% if facilities.mri %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.mri %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "MRI" %}
            </div>
            <div class="facility-item {% if facilities.ct_scan %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.ct_scan %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "CT Scan" %}
            </div>
            <div class="facility-item {% if facilities.ultrasound %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.ultrasound %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "Ultrasound" %}
            </div>
          </div>

          <span class="sec-label">{% trans "Services" %}</span>
          <div class="facility-grid">
            <div class="facility-item {% if facilities.blood_bank %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.blood_bank %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "Blood Bank" %}
            </div>
            <div class="facility-item {% if facilities.laboratory %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.laboratory %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "Laboratory" %}
            </div>
            <div class="facility-item {% if facilities.pharmacy %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.pharmacy %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "Pharmacy" %}
            </div>
            <div class="facility-item {% if facilities.ambulance %}on{% else %}off{% endif %}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">{% if facilities.ambulance %}
                <polyline points="20 6 9 17 4 12" />{% else %}
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />{% endif %}
              </svg>
              {% trans "Ambulance" %}
            </div>
          </div>

          {% if facilities.operation_theaters %}
          <div class="ot-row">
            <div class="ot-left">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
              </svg>
              <span>{% trans "Operation Theaters" %}</span>
            </div>
            <span class="ot-val">{{ facilities.operation_theaters }}</span>
          </div>
          {% endif %}
        </div>

        <!-- Medical Team -->
        <div class="sec-card">
          <div class="sec-header">
            <div class="sec-icon teal">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
              </svg>
            </div>
            <div>
              <h3 class="sec-title">{% trans "Medical Team" %}</h3>
              <p class="sec-sub">{% trans "Our experienced doctors and specialists" %}</p>
            </div>
          </div>

          {% if doctors %}
          {% for doctor in doctors %}
          <div class="doctor-card">
            <div class="doctor-avatar">{{ doctor.name|slice:":1" }}</div>
            <div class="doctor-info">
              <div class="doctor-name-row">
                <span class="doctor-name">Dr. {{ doctor.name }}</span>
                {% if doctor.is_head_doctor %}
                <span class="doctor-head">{% trans "Head" %}</span>
                {% endif %}
              </div>
              <div class="doctor-spec">{{ doctor.specialization }}</div>
              <div class="doctor-quals">
                {% for qual in doctor.qualification|split:", " %}
                <span class="qual-tag">{{ qual }}</span>
                {% endfor %}
              </div>
              <div class="doctor-meta">
                <div class="doctor-meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
                  </svg>
                  {{ doctor.experience_years }} yrs
                </div>
                <div class="doctor-meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" y1="2" x2="16" y2="6" />
                    <line x1="8" y1="2" x2="8" y2="6" />
                    <line x1="3" y1="10" x2="21" y2="10" />
                  </svg>
                  {{ doctor.consultation_days }}
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          {% else %}
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
              <line x1="16" y1="3" x2="22" y2="9" />
            </svg>
            <p>{% trans "No doctor information available at this time." %}</p>
          </div>
          {% endif %}
        </div>

        <!-- Insurance & Schemes -->
        <div class="sec-card">
          <div class="sec-header">
            <div class="sec-icon green">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                <polyline points="9 12 11 14 15 10" />
              </svg>
            </div>
            <div>
              <h3 class="sec-title">{% trans "Accepted Insurance & Schemes" %}</h3>
              <p class="sec-sub">{% trans "Payment methods and coverage" %}</p>
            </div>
          </div>

          {% if hospital.acceptedSchemes %}
          <div class="scheme-tags">
            {% for scheme in hospital.acceptedSchemes %}
            {% with url=scheme.schemeName|scheme_url %}
            {% if url %}
            <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="scheme-tag scheme-tag-link"
              title="Visit official {{ scheme.schemeName }} website">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12" />
              </svg>
              {{ scheme.schemeName }}
              <svg class="scheme-ext-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                <polyline points="15 3 21 3 21 9" />
                <line x1="10" y1="14" x2="21" y2="3" />
              </svg>
            </a>
            {% else %}
            <span class="scheme-tag">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12" />
              </svg>
              {{ scheme.schemeName }}
            </span>
            {% endif %}
            {% endwith %}
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.9 13.5a19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 3.81 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 9.91a16 16 0 0 0 6.1 6.1l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" />
            </svg>
            <p>{% trans "Contact hospital directly for insurance and scheme details." %}</p>
          </div>
          {% endif %}
        </div>

      </div>

      <!-- ── RIGHT COLUMN ── -->
      <div class="sidebar-wrap">

        <!-- Contact Card -->
        <div class="contact-card">
          <div class="contact-header">
            <span class="contact-header-label">{% trans "Get in Touch" %}</span>
            <h4>{% trans "Contact Information" %}</h4>
          </div>
          <div class="contact-body">

            {% if hospital.contact %}
            <a href="tel:{{ hospital.contact }}" class="contact-btn phone">
              <div class="contact-btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path
                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.9 13.5a19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 3.81 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 9.91a16 16 0 0 0 6.1 6.1l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" />
                </svg>
              </div>
              <div>
                <span class="contact-lbl">{% trans "Emergency Line" %}</span>
                <span class="contact-num">{{ hospital.contact }}</span>
              </div>
            </a>
            {% endif %}

            {% if facilities.ambulance and hospital.ambulance_contact %}
            <a href="tel:{{ hospital.ambulance_contact }}" class="contact-btn ambulance">
              <div class="contact-btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="1" y="3" width="15" height="13" rx="1" />
                  <path d="M16 8h4l3 3v5h-7V8z" />
                  <circle cx="5.5" cy="18.5" r="2.5" />
                  <circle cx="18.5" cy="18.5" r="2.5" />
                  <path d="M5 9h4M7 7v4" />
                </svg>
              </div>
              <div>
                <span class="contact-lbl">{% trans "Ambulance Service" %}</span>
                <span class="contact-num">{{ hospital.ambulance_contact }}</span>
              </div>
            </a>
            {% endif %}

            <div class="address-row">
              <div class="address-row-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                  <circle cx="12" cy="10" r="3" />
                </svg>
              </div>
              <div>
                <span class="address-label">{% trans "Full Address" %}</span>
                <p class="address-text">{{ hospital.address }}</p>
                <span class="address-city">{{ hospital.city }} — {{ hospital.pincode }}</span>
              </div>
            </div>

          </div>
        </div>

        <!-- CTA Card -->
        <div class="cta-card">
          <div class="cta-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
          </div>
          <h3>{% trans "Need a Checkup?" %}</h3>
          <p>{% trans "Use our AI-powered symptom checker to get a preliminary health analysis before your visit." %}
          </p>
          <a href="{% url 'index' %}" class="cta-btn">{% trans "Check Symptoms Now" %}</a>
        </div>

      </div>

    </div>
  </div>

</div>
{% endblock %}